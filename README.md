**Grafana to Matrix Forwarder**

Forward alerts from [Grafana](https://grafana.com) to a [Matrix](https://matrix.org) chat room.

 [![pipeline status](https://gitlab.com/hectorjsmith/grafana-matrix-forwarder/badges/main/pipeline.svg)](https://gitlab.com/hectorjsmith/grafana-matrix-forwarder/-/commits/main) [![Go Report Card](https://goreportcard.com/badge/gitlab.com/hectorjsmith/grafana-matrix-forwarder)](https://goreportcard.com/report/gitlab.com/hectorjsmith/grafana-matrix-forwarder)

---

This project provides a simple way to forward alerts generated by Grafana to a Matrix chat room.

Setup up a Grafana webhook alert channel that targets an instance of this application.
This tool will handle converting the incoming alert webhook to a Matrix message and send it on to a specific chat room.

![screenshot of matrix alert message](docs/alertExample.png)

## Features

  * üì¶ **Portable**
    * As a single binary the tool is easy to run in any environment
  * üìé **Simple**
    * No config files, all required parameters provided on startup
  * ü™Å **Flexible**
    * Support multiple grafana alert channels to multiple matrix rooms

## How to use

**Step 1**

Run the forwarder by providing a matrix account to send messages from.

```
$ ./grafana-matrix-forwarder --user @userId:matrix.org --password xxx --homeserver matrix.org
```

**Step 2**

Add a new **POST webhook** alert channel with the following target URL: `http://<ip address>:6000/api/v0/forward?roomId=<roomId>`

*Replace with the server ID and matrix room ID.*

![screenshot of grafana channel setup](docs/grafanaChannelSetup.png)

**Step 3**

Setup alerts in grafana that are sent to the new alert channel.

![screenshot of grafana alert setup](docs/grafanaAlertSetup.png)

## CLI Usage

```
$ grafana-matrix-forwarder -h

  -homeserver string
        url of the homeserver to connect to (default "matrix.org")
  -host string
        host address the server connects to (default "0.0.0.0")
  -logPayload
        print the contents of every alert request received from grafana
  -password string
        password used to login to matrix
  -port int
        port to run the webserver on (default 6000)
  -user string
        username used to login to matrix
  -version
        show version info and exit
``` 

## Thanks

Made possible by the [maunium.net/go/mautrix](https://maunium.net/go/mautrix/) library and all the contributors to the [matrix.org](https://matrix.org) protocol.
